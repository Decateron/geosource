<link rel="import" href="../bower_components/iron-form/iron-form.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-icons/image-icons.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">

<dom-module id="post-creator">
	<style>
		paper-textarea {
			width: 200px;
		}
		.hidden {
			display: block;
			visibility: hidden;
			width: 0;
			height: 0;
			padding: 0;
			margin: 0;
		}
		img {
			height: 75px;
			margin: 15px;
			margin-left: 0;
			margin-bottom: 0;
		}
		paper-button {
			color: #000;
			text-transform: none;
			margin: 0;
			display: block;
			width: 200px;
		}
		paper-button.field {
			background-color: #ddd;
		}
		.title {
			font-size: 18px;
			font-weight: bold;
		}
		.contents {
			background-color: #eee;
			padding: 15px;
			margin-bottom: 15px;
		}
		paper-textarea {
			font-size: 14px;
			width: 100%;
		}
		paper-checkbox {
			padding: 0;
			margin-top: 10px;
		}
		paper-checkbox:first-child {
			margin-top: 0;
		}
		paper-radio-button {
			padding: 0;
			margin-top: 10px;
		}
		paper-radio-button:first-child {
			margin-top: 0;
		}
		h2 {
			margin-bottom: 0;
		}
		paper-dropdown-menu {
			--paper-dropdown-menu: {
				paper-menu-button.paper-dropdown-menu {
					padding: 0;
				}
			};
		}
	</style>
	<template>
		<h2>Channel</h2>
		<div class="contents">
			<paper-dropdown-menu label="Select a channel..." no-label-float>
				<paper-menu class="dropdown-content" selected="{{channelIndex}}">
					<template is="dom-repeat" items="{{channels}}">
						<paper-item>{{item.name}}</paper-item>
					</template>
				</paper-menu>
			</paper-dropdown-menu>
		</div>

		<template is="dom-repeat" items="{{channel.fields}}" as="field">
			<h2>{{field.label}}</h2>
			<div class="contents">
				<template is="dom-if" if="{{isText(field)}}">
					<paper-input label="Enter text..." no-label-float value="{{field.value}}"></paper-input>
				</template>
				<template is="dom-if" if="{{isImages(field)}}">
					<input class="hidden" id="file" name="field-2" type="file" capture="camera" accept="image/*" multiple on-change="getPosts">
					<paper-button class="field" on-tap="openFiles">
						<iron-icon icon="image:camera-alt"></iron-icon>
						<span>Add Pictures</span>
					</paper-button>
					<div id="pictures"></div>
				</template>
				<template is="dom-if" if="{{isCheckBoxes(field)}}">
					<paper-radio-group>
						<template is="dom-repeat" items="{{field.subfields}}" as="subfield">
							<paper-checkbox checked="{{subfield.value}}">{{subfield.label}}</paper-checkbox><br>
						</template>
					</paper-radio-group>
				</template>
				<template is="dom-if" if="{{isRadioButtons(field)}}">
					<paper-radio-group>
						<template is="dom-repeat" items="{{field.subfields}}" as="subfield">
							<paper-radio-button checked="{{subfield.value}}">{{subfield.label}}</paper-radio-button><br>
						</template>
					</paper-radio-group>
				</template>
			</div>
		</template>

		<div class="horizontal layout flex">
			<paper-button class="flex" on-tap="clear">Cancel</paper-button>
			<paper-button class="flex" on-tap="save">Save Draft</paper-button>
			<paper-button class="flex" on-tap="submit">Submit</paper-button>
		</div>
	</template>
</dom-module>

<script>
	Polymer({
		is: "post-creator",

		properties: {
			channels: {
				type: Array,
				value: [],
			},
			channelIndex: {
				type: Number,
				value: null,
				observer: "channelChanged",
			},
			channel: {
				type: Object,
				value: null,
			},

		},

		channelChanged: function() {
			console.log(this.channelIndex);
			this.channel = this.channels[this.channelIndex];
		},

		isText: function(field) {
			return field.type == "Text";
		},

		isImages: function(field) {
			return field.type == "Images";
		},

		isCheckBoxes: function(field) {
			return field.type == "CheckBoxes";
		},

		isRadioButtons: function(field) {
			return field.type == "RadioButtons";
		},

		openFiles: function(event) {
			console.log(event.model);
			event.model._nodes[0].click();
			// this.$.file.click();
		},

		getPosts: function(event) {
			console.log(event);
			var list = event.model._nodes[2];
			Polymer.dom(list).innerHTML = "";

			var files = event.model._nodes[0].files;
			for (var i=0; i< files.length; i++) {
				var file = files[i];
				var reader = new FileReader();
				var blob = file.slice(0, file.size);
				// this.storeFile(blob, "file-"+i);
				reader.onload = function(event) {
					var result = event.target.result;
					var img = new Image();
					img.src = result;
					Polymer.dom(list).appendChild(img);
				}.bind(this);
				reader.readAsDataURL(blob);
			}
		},

		submit: function() {
			// var form = this.$.form;
			// var formData = new FormData(form);
			// var xhr = new XMLHttpRequest();
			// xhr.open('POST', '/upload', true);
			// xhr.send(formData);
			console.log(this.channel);
		}
	});
</script>